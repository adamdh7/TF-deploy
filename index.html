<!doctype html>
<html lang="ht">
<head>
  <meta charset="utf-8" />
  <!-- Disable zoom on iOS/Android (pa 100% garanti pou tout ka) -->
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>üòÇüëçüèªOn ti click</title>
  <style>
    /* Basic iOS-like card */
    :root{
      --bg:#f2f5f7;
      --card:#ffffff;
      --accent:#007aff; /* iOS blue */
      --muted:#8e8e93;
    }
    html,body{
      height:100%;
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,var(--bg),#eef3f6);
      -webkit-user-select:none; user-select:none;
      -webkit-touch-callout:none;
      overscroll-behavior-y: none; /* helps prevent pull-to-refresh in some browsers */
    }
    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      box-sizing:border-box;
    }
    .card{
      width:100%;
      max-width:420px;
      background:var(--card);
      border-radius:16px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.08);
      padding:18px;
      box-sizing:border-box;
    }

    .title{
      font-size:20px;
      font-weight:600;
      margin:0 0 10px 0;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .counters{
      display:flex;
      gap:8px;
      justify-content:space-between;
      margin-bottom:16px;
      align-items:center;
    }
    .counter{
      flex:1;
      background:linear-gradient(180deg,#fbfcfd,#f7f9fb);
      border-radius:12px;
      padding:10px;
      text-align:center;
      min-width:0;
    }
    .label{
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .value{
      font-size:16px;
      font-weight:700;
      margin-top:6px;
    }

    .btn-row{
      display:flex;
      gap:10px;
      margin-top:12px;
      align-items:center;
    }

    .btn{
      flex:1;
      padding:14px 12px;
      border-radius:12px;
      border:0;
      font-size:16px;
      font-weight:600;
      background:var(--accent);
      color:white;
      -webkit-tap-highlight-color: transparent;
    }

    .info{
      margin-top:12px;
      color:var(--muted);
      font-size:13px;
      line-height:1.3;
    }

    /* responsive text clamp */
    .truncate {
      display:block;
      -webkit-line-clamp:1;
      -webkit-box-orient:vertical;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* try to prevent zoom gestures */
    html, body, input, button { touch-action: manipulation; }

    @media (max-width:380px){
      .title{ font-size:18px; }
      .value{ font-size:15px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main">
      <h1 class="title truncate">Klike pou'n lage</h1>

      <div class="counters" aria-live="polite">
        <div class="counter" title="S - Semaine derni√®re">
          <div class="label">S</div>
          <div id="count-week" class="value">0</div>
        </div>
        <div class="counter" title="Y - Hier">
          <div class="label">Y</div>
          <div id="count-yesterday" class="value">0</div>
        </div>
        <div class="counter" title="J - Aujourd'hui">
          <div class="label">J</div>
          <div id="count-today" class="value">0</div>
        </div>
        <div class="counter" title="T - Total">
          <div class="label">T</div>
          <div id="count-total" class="value">0</div>
        </div>
      </div>

      <div class="btn-row">
        <button id="redirectBtn" class="btn" type="button">Cliquez</button>
      </div>

      <p class="info">
        NB: reste 7s minimum 
      </p>
    </div>
  </div>

  <!-- script third-party (f√® yo chaje asenkron) -->
  <script>
    // ajoute script ke ou te bay la (chaje asenkron)
    (function(){
      var s = document.createElement('script');
      s.type = 'text/javascript';
      s.async = true;
      s.src = '//pl28135197.effectivegatecpm.com/3b/5a/09/3b5a097d28211945158c20a3f4879260.js';
      document.body.appendChild(s);
    })();
  </script>

  <script>
  (function(){
    // === Konf ===
    const REDIRECT_URL = 'https://www.effectivegatecpm.com/h5d719bhae?key=5d76ce4bb78c40c2664a52c31c4f62e8';
    const REQUIRED_SECONDS = 7 * 1000; // 7s
    const POLL_MS = 250;
    const STORAGE_KEY = 'egc_counter_v1';

    // === State & persistence (senp) ===
    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return defaultState();
        const obj = JSON.parse(raw);
        // Sanity check + migrate if neses√®
        if(!obj._meta || !obj.total) return defaultState();
        // rotate days/weeks if dat chanje
        rotateIfNeeded(obj);
        return obj;
      }catch(e){ return defaultState(); }
    }
    function defaultState(){
      const today = isoDate(new Date());
      const weekKey = weekKeyFromDate(new Date());
      return {
        _meta: { lastUpdate: today, weekKey },
        todayDate: today,
        today: 0,
        yesterday: 0,
        week: 0,
        total: 0
      };
    }
    function saveState(s){ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); }

    function isoDate(d){ return d.toISOString().slice(0,10); }
    function weekKeyFromDate(d){
      // ISO week key fallback: use year + week number approximation (Mon as first day)
      const tmp = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
      const dayNum = tmp.getUTCDay() || 7;
      tmp.setUTCDate(tmp.getUTCDate() + 4 - dayNum);
      const yearStart = new Date(Date.UTC(tmp.getUTCFullYear(),0,1));
      const weekNo = Math.ceil( ( (tmp - yearStart) / 86400000 + 1) / 7 );
      return tmp.getUTCFullYear() + '-W' + String(weekNo).padStart(2,'0');
    }
    function rotateIfNeeded(state){
      const today = isoDate(new Date());
      // day rotate
      if(state.todayDate !== today){
        // shift today -> yesterday
        state.yesterday = state.today;
        state.today = 0;
        state.todayDate = today;
        state._meta.lastUpdate = today;
      }
      // week rotate
      const wk = weekKeyFromDate(new Date());
      if(state._meta.weekKey !== wk){
        state.week = 0;
        state._meta.weekKey = wk;
      }
    }

    // === UI ===
    const elToday = document.getElementById('count-today');
    const elYest = document.getElementById('count-yesterday');
    const elWeek = document.getElementById('count-week');
    const elTotal = document.getElementById('count-total');

    let state = loadState();
    render();

    function render(){
      elToday.textContent = formatMoney(state.today);
      elYest.textContent = formatMoney(state.yesterday);
      elWeek.textContent = formatMoney(state.week);
      elTotal.textContent = formatMoney(state.total);
      saveState(state);
    }
    function formatMoney(n){
      // affike ak $ devan tankou egzanp ou te bay ($Shif)
      return '$' + String(n);
    }

    // === Counter increment logic ===
    function incrementCounts(){
      rotateIfNeeded(state);
      state.today += 1;
      state.week += 1;
      state.total += 1;
      render();
    }

    // === Redirect + track logic ===
    document.getElementById('redirectBtn').addEventListener('click', function(e){
      // Ouvri nouvo fen√®t / tab san noopener pou kenbe referans
      // Note: sou k√®k mobil, popup oswa new tab ka bloke selon param√®t browser
      let newWin;
      try{
        newWin = window.open(REDIRECT_URL, 'egc_external_window'); // same name reuse same tab si browser sa f√® sa
      }catch(err){
        newWin = null;
      }
      if(!newWin){
        alert('Ouv√®ti tab/fen√®t bloke. Eseye p√®m√®t popups oswa kite bouton an louvri lyen dir√®kteman.');
        return;
      }

      const start = Date.now();
      let counted = false;
      const poll = setInterval(() => {
        // Si fen√®t la f√®men avan 7s -> pa konte
        try{
          if(newWin.closed){
            clearInterval(poll);
            if(!counted){
              console.log('Fen√®t la f√®men anvan 7s ‚Äî pa konte');
            }
            return;
          }
          // si toujou ouv√® epi tan >=7s => konte
          if(!counted && (Date.now() - start) >= REQUIRED_SECONDS){
            counted = true;
            incrementCounts();
            // opsyon√®l: voye telemetri sou serve a: fetch('/api/increment', {method:'POST'}) ...
            console.log('Konte +1 paske fen√®t la rete 7s oubyen plis.');
            // kenbe polling pou jere si fen√®t la f√®men pita (ou ka sispann si vle)
            // clearInterval(poll);
          }
        }catch(err){
          // aks√® cross-origin pa neses√® pou closed, men si gen er√®, sispann
          console.warn('Er√® pandan polling:', err);
          clearInterval(poll);
        }
      }, POLL_MS);

      // fallback timeout (evite polling san limit)
      setTimeout(()=> clearInterval(poll), 60000); // sispann apre 60s
    });

    // === Optional: anpeche refresh/pull-to-refresh (pa garanti 100%) ===
    // Atansyon: navigat√® pa bay API pou anpeche reload totalman ‚Äî pa gen solisyon 100%
    // Men nou mete k√®k pwoteksyon pou evite zoom/pull-to-refresh sou mobil:
    (function tryPreventPullToRefresh(){
      let maybePrevented = false;
      // Prevent overscroll on body (s√®vi ak CSS overscroll-behavior antye)
      // Also prevent default on touchmove si scroll top = 0 (works partially)
      document.addEventListener('touchstart', function(e){
        // nothing heavy here
      }, {passive:true});

      let lastY = 0;
      window.addEventListener('touchmove', function(e){
        if(window.scrollY === 0 && e.touches && e.touches.length === 1){
          const curY = e.touches[0].clientY;
          if(curY > lastY + 8){
            // pulling down ‚Äî try to prevent
            e.preventDefault();
            maybePrevented = true;
          }
          lastY = curY;
        }
      }, {passive:false});
      // This may break some scrolling behaviour; test on devices.
    })();

    // expose for debugging
    window._egc_state = {
      get: () => state,
      inc: () => incrementCounts(),
    };

  })();
  </script>
</body>
  </html>
